#### Задача №2.

Есть таблица Session:
```
id, 
user_id, 
login_time, 
logout_time
```
В ней хранится id пользователя, время входа и время выхода из системы
(может быть null, если визит еще не завершен).

Определить в какое время за отдельно взятые сутки в системе находилось одновременно
максимальное число пользователей.

#### Обсуждения задачи
- Обсуждение задачи: https://www.programmersforum.ru/showthread.php?t=343679
- ``others/getMaxUsersActivity.php`` - готовое решение на php и SQlite из https://github.com/NanakiRus/Adv.Cake/blob/master/test.php
- ``others/chat_gpt_v3.sql`` - решение от chatGPT v.3 на SQL (не рабочее)
- ``others/insert_in_loop.sql`` - решение по вставке множества случайных данных в БД на SQL

#### Мое решение
Пробовал решать на разных бД (т.к. в задаче не указано, на какой).

Т.о. разбито по папкам:
##### sqlite (не рабочее)
- решение для БД SQlite (прототип, не хватает скрипта по создаию БД и наполнению ее данными)
- ``find_max_sessions.php`` - скрипт, ищущий требуемое решение _(нужно доработать)_

##### mysql (не рабочее)
- ``create_table.sql`` - создание таблицы в БД
- скрипт для поиска можно взять/доработать из версии с sqlite выше _и доработать_

##### postgres (рабочее решение!)
- ``sessions_data.pgsql`` - файл с дампом БД от заказчика (нужна доработка)
- ``sesions_data_new.pgsql`` - файл с рабочим дампом БД (грузим его)
- ``database.ini`` - файл с настройками коннекта к БД
- ``PgConnection.php`` - класс для коннекта к БД
- ``SessionsDB.php`` - класс для выполнения запросов к БД
- ``SessionsView.php`` - класс для отображения результатов
- ``index.php`` - скрипт запуска (расчеты и вывод результатов)

#### Запуск/проверка работы скрипта
- Грузим дамп БД в консоли:
``` 
cd postgres
psql -U postresql -d sessions -a -f sessions_data_new.pgsql
```

- Запускаем скрипт:
```
php index.php

[ RESULT ] Maximum amount of sessions on period [2023-05-23 00:00:00 ... 2023-05-23 23:59:59] 
is on time interval [2023-05-23 16:52:51 ... 2023-05-23 23:59:59]: 233
``` 

- **Проверяем:** выполняем запрос в БД:
  Напишем sql запрос определяющий количество активных пользователей в системе
  за указанный промежуток времени:
  2023-05-23 16:52:51 ... 2023-05-23 23:59:59 
```
SELECT COUNT(DISTINCT user_id)
FROM public.timetable
WHERE login_time >= 1684853571
  AND (logout_time IS NULL OR logout_time <= 1684879199);
-- 1525 сессии (не сходится с вычисленным выше 233 - никак ...)
```
 
 